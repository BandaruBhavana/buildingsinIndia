# Buildings, amenities, and facilities in India
## Problem Statement:
The problem at hand involves processing geographical data stored in CSV files, specifically focusing on the 'building' and 'amenity' information. The primary challenges are to extract meaningful information, handle missing or incorrectly formatted data, and store the processed data in a relational database. Additionally, the data includes geographic coordinates in the 'longitude-latitude' column, which needs to be separated into distinct 'longitude' and 'latitude' columns for further analysis.
One significant issue is the presence of missing or improperly formatted data, which could impede the extraction process. Furthermore, the 'All_tags' column holds information in string representations of dictionaries, requiring careful parsing to extract relevant details for subsequent storage in a database.
The task involves designing appropriate database tables, handling data types, and establishing relationships to ensure efficient data retrieval and analysis. Additionally, the code must be scalable to accommodate large datasets while maintaining optimal performance during the extraction and insertion processes.

## Approach:
The approach to addressing these challenges involves a systematic and iterative process. First, the code reads the CSV files to identify column names, providing insights into the structure of the data. It establishes a connection to a MySQL database and creates tables to store 'building' and 'amenity' information separately. This ensures a well-organized database structure that aligns with the nature of the data.
To handle missing or improperly formatted data, the code utilizes regular expressions to extract 'longitude' and 'latitude' from the 'longitude-latitude' column. It employs error-checking mechanisms to identify and log any issues during the extraction process, ensuring the reliability of the data.
For database insertion, the code uses prepared SQL statements to efficiently insert batches of data into the corresponding tables. The insertion process is optimized by committing changes in batches, reducing the overhead associated with individual insertions.
To handle the diverse data in the 'All_tags' column, the code uses the 'ast' module to parse string representations of dictionaries. This step allows the extraction of relevant information for storage in the database, enhancing the completeness and usability of the dataset.
The approach also considers scalability by implementing batch processing for database insertion. This not only enhances performance but also prevents potential memory issues when dealing with large datasets.
Overall, the iterative nature of the approach, coupled with error-checking mechanisms and database optimization techniques, ensures the reliability, accuracy, and scalability of the data processing. 

## Process:
### 1. Data Collection: 
The raw data were obtained from Geofabrik which had all details about entities present in India. The CSV files are generated by a script that takes data from OSM(OpenStreetMap) file in a ProtocolBuffer Binary format(pbf).

### Datasets:
building.csv - Details about buildings such as node id(since the OSM file uniquely identifies each entry by a node id), building name, type, location(longitude - latitude), other tags. 
<img width="807" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/ee2ea9e5-b87f-4e06-90e8-a57986242ec8">

amenity.csv - Amenity type, name, location, other tags. 
<img width="876" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/97bbfb81-dd13-46ba-9c8b-2b87a7256e3b">


### 2. Data Exploration and Preprocessing:
Code:

<img width="512" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/5ce04646-30af-4d9b-8dc4-2ea33d561b7f">
Output:
Basic Information about the DataFrame:
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 10012423 entries, 0 to 10012422
Data columns (total 5 columns):
 #   Column               Dtype 
---  ------               ----- 
 0   Unnamed: 0           int64 
 1   name                 object
 2   building             object
 3   longitude-lattitude  object
 4   All_tags             object
dtypes: int64(1), object(4)
memory usage: 381.9+ MB
None

First Few Rows of the DataFrame:
   Unnamed: 0                                  name  \
0   201415532                                   NaN   
1   241856093                         Ramneek Singh   
2   248128247                          Haydon Manor   
3   287411687  World's Highest Altitude Retail Pump   
4   311477023                   Adarsh Nagar Market   

                                       building  \
0                                         house   
1                                           yes   
2                                   residential   
3                                           yes   
4  PETALS_IMMIGRATION_AND_EDUCATION_CONSULTANTS   

                       longitude-lattitude  \
0         (75.2131566, 12.068674200000073)   
1   (75.83550110000056, 30.88409649999983)   
2  (77.60479749999985, 12.956302800000017)   
3   (78.06994470000019, 32.22763100000002)   
4  (75.56264090000002, 31.330393499999992)   

                                            All_tags  
0  {'building': 'house', 'addr:street': 'Ramantha...  
1  {'name': 'Ramneek Singh', 'FIXME': 'name of th...  
2  {'name': 'Haydon Manor', 'building': 'resident...  
3  {'name': "World's Highest Altitude Retail Pump...  
4  {'addr:city': 'JALANDHAR', 'addr:housenumber':...  

Number of Missing Values in 'longitude-lattitude' column: 9979089

DataFrame with Separated Longitude and Latitude:
           longitude            latitude
0         75.2131566  12.068674200000073
1  75.83550110000056   30.88409649999983
2  77.60479749999985  12.956302800000017
3  78.06994470000019   32.22763100000002
4  75.56264090000002  31.330393499999992

Code:

<img width="446" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/a56c90d4-7f56-4bbf-9336-86bb725542a9">
Output:
DtypeWarning: Columns (3) have mixed types. Specify dtype option on import or set low_memory=False.
  df = pd.read_csv('amenity.csv')
Basic Information about the DataFrame:
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 311462 entries, 0 to 311461
Data columns (total 5 columns):
 #   Column               Non-Null Count   Dtype 
---  ------               --------------   ----- 
 0   Unnamed: 0           311462 non-null  int64 
 1   name                 261326 non-null  object
 2   amenity              311462 non-null  object
 3   longitude-lattitude  243123 non-null  object
 4   All_tags             311462 non-null  object
dtypes: int64(1), object(4)
memory usage: 11.9+ MB
None

First Few Rows of the DataFrame:
   Unnamed: 0                        name           amenity  \
0    30612110                       Vaduj              fuel   
1    46547616             Tathgar Jathere  place_of_worship   
2    53102901  Guru Nanak Dev Polytechnic           college   
3    59710905                  SV medicos          pharmacy   
4    59828202                Arora Palace            cinema   

                       longitude-lattitude  \
0  (74.45046609999974, 17.595082199999982)   
1   (75.86404069999998, 30.85324219999996)   
2  (75.86231330000004, 30.857513399999974)   
3   (75.86695529999986, 30.87485329999991)   
4  (75.85845769999987, 30.873550099999918)   

                                            All_tags  
0  {'name': 'Vaduj', 'is_in': 'Khatav', 'place': ...  
1  {'name': 'Tathgar Jathere', 'amenity': 'place_...  
2  {'name': 'Guru Nanak Dev Polytechnic', 'amenit...  
3  {'name': 'SV medicos', 'amenity': 'pharmacy', ...  
4      {'name': 'Arora Palace', 'amenity': 'cinema'}  

Number of Missing Values in 'longitude-lattitude' column: 68339

DataFrame with Separated Longitude and Latitude:
           longitude            latitude
0  74.45046609999974  17.595082199999982
1  75.86404069999998   30.85324219999996
2  75.86231330000004  30.857513399999974
3  75.86695529999986   30.87485329999991
4  75.85845769999987  30.873550099999918

### 3. Database Connection:
<img width="326" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/3d055e57-204c-4d66-ace2-38ef654c1194">

### 4. Databases Creation:

    CREATE TABLE IF NOT EXISTS `buildings` (
        `bid` INT AUTO_INCREMENT PRIMARY KEY,
        `name` VARCHAR(100) DEFAULT NULL,
        `building_type` VARCHAR(50) DEFAULT NULL,
        `longitude` FLOAT DEFAULT NULL,
        `latitude` FLOAT DEFAULT NULL,
        `tags` TEXT DEFAULT NULL
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

    CREATE TABLE IF NOT EXISTS `amenity` (
        `aid` INT AUTO_INCREMENT PRIMARY KEY,
        `name` VARCHAR(100) DEFAULT NULL,
        `amenity_type` VARCHAR(50) DEFAULT NULL,
        `longitude` FLOAT DEFAULT NULL,
        `latitude` FLOAT DEFAULT NULL,
        `tags` TEXT DEFAULT NULL
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

### 5. Establishing the connection 

conn = pymysql.connect(
    host='mysql.clarksonmsda.org',
    port=3306,
    user='ia626',
    passwd='ia626clarkson',
    db='ia626',
    autocommit=True
)
cur = conn.cursor(pymysql.cursors.DictCursor)

### 6. Importing Data from CSV files to MYSQL databases

<img width="292" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/a8faf757-eb46-47e2-aa20-cb08adb18fb1">


<img width="250" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/7c94a65e-3ad1-45ef-9701-c9c330d7673a">

Output:

<img width="624" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/66d541dc-2bcb-4838-b863-ee2450222d15">

<img width="786" alt="image" src="https://github.com/BandaruBhavana/buildingsinIndia/assets/111446938/bea62b09-7622-4d37-a2f9-09f492ba30b9">











